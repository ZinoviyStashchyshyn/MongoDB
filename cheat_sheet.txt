

////////////////////////////////////////////////////////.find({})///////////////////////////////////////////////////////

FIND (функція) приймає декілька об'єктів.
Перший - це об'єкт пошуку, другий - це те, що ми хочемо дістати.
Оскільки по замовчуванню вона віддає всі поля. Через true, або false. певні поля дістаємо, або не дістаємо.

db.getCollection('teacher').find(
        { payment: 2500, class_curator: 6 },
        { name: true, payment: true, _id: false }
);
------------------------------------------------------------------------------------------------------------------------

Пошук усіх в кого payment 2500

db.getCollection('teacher').find({ payment: 2500 });
------------------------------------------------------------------------------------------------------------------------

Шукаємо в кого поле масиву є обєктом з значенням 'cars.model' : 'XC90'  !!!  Обєкт тільки такий спосіб доступу

db.getCollection('teacher').find({ 'cars.model' : 'XC90' })
------------------------------------------------------------------------------------------------------------------------

Шукаємо всіх в кого в масиві під другим індексом авто BMW . БУТИ УВАЖНИМ ДО СИНТАКСИСУ!!!!!!

db.getCollection('teacher').find({ 'cars.2' : 'BMW' })
------------------------------------------------------------------------------------------------------------------------

Шукаємо усіх в кого ім'я починається (^o) на  о, при цьому за допоиогою i ігноруємо велику та малу букву.

db.getCollection('teacher').find({ name: /^o/i })
------------------------------------------------------------------------------------------------------------------------

Шукаємо усіх в кого ім'я закінчується (vna$)  на  vna, при цьому за допоиогою i ігноруємо велику та малу букву.

db.getCollection('teacher').find({ name: /vna$/i })
------------------------------------------------------------------------------------------------------------------------

Шукаємо усіх в кого ім'я містить (.*iv.*)  iv, при цьому за допоиогою i ігноруємо велику та малу букву.

db.getCollection('teacher').find({ name: /.*iv.*/i });
------------------------------------------------------------------------------------------------------------------------

Шукаємо всіх в кого три авто                    ----SIZE----

db.getCollection('teacher').find({ cars: { $size: 3 } });
------------------------------------------------------------------------------------------------------------------------

Шукаємо всіх в кого немає машини               ----EXISTS----

db.getCollection('teacher').find({ cars: { $exists: false } });
------------------------------------------------------------------------------------------------------------------------

Шукаємо всіх в кого авто BMW

db.getCollection('teacher').find({ cars: 'BMW' });
------------------------------------------------------------------------------------------------------------------------

Цей варіант функції find, коли ми працюємо через   ----OR----   тобто або такий, або такий варіант нам підходить.

db.getCollection('teacher').find({
       $or: [
           { payment: 2500 },
           { payment: 2200 },
           { class_curator: 6 }
       ]
});
------------------------------------------------------------------------------------------------------------------------

Цей варіант функції find, коли ми працюємо черрез  ----AND----  тобто: строго такий і строго такий варіант нам підходить.
Це потрібно для більш складних запитів.

db.getCollection('teacher').find({
       $and: [
           { payment: 2500 },
           { class_curator: 6 }
       ]
});
------------------------------------------------------------------------------------------------------------------------

Шукаємо всіх в кого class_curator: 7,8,9           ----IN----

db.getCollection('teacher').find({
        class_curator: {
            $in: [7, 8, 9]
        }
});
------------------------------------------------------------------------------------------------------------------------

Шукаємо всіх в кого class_curator  не : 7,8,9      ----NIN----

db.getCollection('teacher').find({
        class_curator: {
            $nin: [7, 8, 9]
        }
});
------------------------------------------------------------------------------------------------------------------------

Той варіант, коли ми знаємо лише дані котрі нам    ----NOT----       не підходятьюте, те саме, що $in:[7,8,9]

db.getCollection('teacher').find({
        class_curator: {
            $not: {
              $nin: [7, 8, 9]
            }
        }
});
------------------------------------------------------------------------------------------------------------------------

                                          ---- >=, <=, <, >, !=, === ----

db.getCollection('teacher').find({
        payment: {
//              $gte: 2500         // >=
//              $lte: 2500        // <=
//              $lt: 2500        // <
//              $gt: 2500       // >
//              $ne: 2500      // !=
//              $eq: 2500     // ===
        }
});
------------------------------------------------------------------------------------------------------------------------

//////////////////////////////////////////////////////.insert({})///////////////////////////////////////////////////////

Додаємо в базу даних  новий об'єкт, з ключами: model,year,price

db.getCollection('teacher').insert({
    model: "Yamaha Fazer",
    year: 2008,
    price: 3000
});
------------------------------------------------------------------------------------------------------------------------

//////////////////////////////////////////////////////.sort({})/////////////////////////////////////////////////////////

Перше шукаємо, а потім сортуємо в порядку спадання payment: -1, та name: -1 (в алфавітному порядку!!!)

db.getCollection('teacher').find({}).sort({ payment: -1, name: -1 });
------------------------------------------------------------------------------------------------------------------------

/////////////////////////////////////////////////.limit().skip()///////////////////////////////////////////////

Перше шукаємо, а потім сортуємо в порядку спадання payment: -1,
limit на сторінку покаже лише 3,
skip - пропустить шість і почне працювати з сьомого.

db.getCollection('teacher').find({}).sort({ payment: -1 }).limit(3).skip(6);
------------------------------------------------------------------------------------------------------------------------

/////////////////////////////////////////////////.update({})////////////////////////////////////////////////////////////

Має три об'єкта

db.getCollection('teacher').update(
    {}, // FIND       кого
    {}, // UPDATE     що
    {}  // OPTIONS    ....
);
------------------------------------------------------------------------------------------------------------------------

Оновлюємо певному обєкту payment, але виходить, що ми його перезаписуємо!!!!! Відповідно ламаємо!

db.getCollection('teacher').update(
    { _id: ObjectId("61176d106279a96d5004093f") },
    { payment: 3500 }
);
------------------------------------------------------------------------------------------------------------------------

                                                 ----SET----

Оновлюємо обєкт, при цьому вставляємо йому поле cars ПЕРШОМУ, бо це не мульті !!!!

db.getCollection('teacher').update(                    // це старий варіант з мульті
    { payment: { $lte: 2500 } },
    { $set: { cars: ["Mazda", "Volga"] } },
    { multi: true }
);
------------------------------------------------------------------------------------------------------------------------

Шукаємо в кого одна машина і додаємо об'єкт першому (бо не Many) машину VOLVO в масиві

db.getCollection('teacher').update(
  { cars: { $size: 1 } },
  { $set: { 'cars.$[]' : 'Volvo' } }
  );
------------------------------------------------------------------------------------------------------------------------

/////////////////////////////////////////////////.updateMany({})////////////////////////////////////////////////////////

Шукаємо в кого одна машина  В МАСИВІ І ДОДАЄМО ПОЛЕ PRICE 9999 ОБЄКТ !!!

db.getCollection('teacher').updateMany(
 { cars: { $size: 1 } },
  { $set: { 'cars.$[].price' : '99999' } }
);
------------------------------------------------------------------------------------------------------------------------
Шукаємо усіх в кого зарплата <= 2500 і додаємо в масив з двома авто ["Mazda", "Volga"]

db.getCollection('teacher').updateMany(               //  краще новіше!!!!
    { payment: { $lte: 2500 } },
    { $set: { cars: ["Mazda", "Volga"] } }
);
------------------------------------------------------------------------------------------------------------------------

/////////////////////////////////////////////////.remove({})////////////////////////////////////////////////////////////

Видаляємо об'єкт в якого є поле Yamaha Fazer

db.getCollection('teacher').remove({model:"Yamaha Fazer"});
------------------------------------------------------------------------------------------------------------------------

///////////////////////////////////////////////// IMPORT JSON TO MONGO /////////////////////////////////////////////////

mongoimport --db DZ --collection rest --file restaurants.json це для убунта або мак
);

                              WINDOWS  через mongoCompass - відео aprill-2021  (1.25хв - 1.30хв).
------------------------------------------------------------------------------------------------------------------------



/////////////////////////////////////////////////.aggregate([{},{},{},{}])//////////////////////////////////////////////

db.getCollection('teacher').aggregate([
  {},
  {},
  {},
  {},
  {}
]);
------------------------------------------------------------------------------------------------------------------------


///////////////////////////////////////////////// $group:{} ///////////////////////////////////////////////////////////


db.getCollection('teacher').aggregate([
    {
         $group: {
                _id: 0,
                maxPay: { $max: "$payment" },      // максимальна заплата
                minPay: { $min: "$payment" },
                avgPay: { $avg: "$payment" },
                sumPay: { $sum: "$payment" },
                count:  { $sum: 1 },                //кількість полів зарплати
         }
     }
]);
------------------------------------------------------------------------------------------------------------------------


///////////////////////////////////////////////// $count:{} ////////////////////////////////////////////////////////////

db.getCollection('teacher').aggregate([
     {
           $match: {
                cars: 'Mazda'
           }
     },
     { $count: "teachers_with_Mazda" }
]);
------------------------------------------------------------------------------------------------------------------------


                                                    $groupe:{} - групує.
                                                    $sum:1 - сумує

/////////////////////////////////////////////////.aggregate([{$group:{}}])//////////////////////////////////////////////


Групуємо по зарплаті, рахуємо викладачів з такою зарплатою.

db.getCollection('teacher').aggregate([
    {
        $group: {
                _id: "$payment",             // обовязко даємо _id,  та знак $, це дає розуміння по чому ми групуємо
                countOfTeachers: {
                       $sum: 1               // прописуємо ключ countOfTeachers, функція $sum рахує скільки викладачів з
                }                               відповідною зарплатою
          }
    }
]);
------------------------------------------------------------------------------------------------------------------------


                                                  {$project:{}} - перезаписує

/////////////////////////////////////////////////.aggregate([{$project:{}}])////////////////////////////////////////////

Групуємо по зарплаті.
Рахуємо викладачів з такою зарплатоюю
Сортуємо в порядку зростання кількості вчителів до відповідної зарплати.
Функцією project переіменовуємо id, відображаємо каунтер і виключаємо _id, вона ще може додавати поля

db.getCollection('teacher').aggregate([
    {
        $group: {
                _id: "$payment",              // обовязко даємо _id,  та знак $, це дає розуміння по чому ми групуємо
                countOfTeachers: {
                       $sum: 1                // прописуємо ключ countOfTeachers, функція $sum рахує скіль викладачів з
                }                                відповідною зарплатою
          }
    },
    {
          $sort: {
                countOfTeachers: 1            // сортуємо в порядку зростання значення
           }
     },
     {
            $project: {
                    money: "$_id",             // заводемо значення payment у ключ змінну money
                    countOfTeachers: 1,        // відображаємо countOfTeachers, оскільки $projectб його перезатер
                    _id: 0                     // приховуємо поле _id: 0, в котрому відображалось $payment
             }
      }
]);
------------------------------------------------------------------------------------------------------------------------


                                                  $lookup:{} - приєднання

///////////////////////////////////////////////// aggregate([{$lookup:{}}]) ////////////////////////////////////////////


db.getCollection('teacher').aggregate([
    {
        $lookup: {
               from: "students",               // приєднуємо students до teacher, /from - це вибірка з якоїсь БД в нашому порівння полів нашої БД teacher з БД students
               localField: "class_curator",    // приєднуємо в teacher, в поле class_curator / пошук по конкретному полі class_curator НОШОЇ ПОТОЧНОЇ БД
               foreignField: "class",          // що приєднюємо, а саме клас що співпадають /пошук по конкретному полі class ПОРІВНЮВАНОЇ  БД
               as: "zabriki"                   // приєднюємо обєкти що співпали під назвою zabriki / добавляємо поле нашій БД teacher під назвою zabriki де буде весь порівнюваний ОБЄКТ з students по ключі class
                 }
         }
]);
------------------------------------------------------------------------------------------------------------------------


                                               $match:{} - пошукова агрегація

/////////////////////////////////////////////////aggregate([{$match:{}}])///////////////////////////////////////////////


db.getCollection('teacher').aggregate([
    {
           $match: {                                 // в кого class_curator: { $exists: true }
                class_curator: { $exists: true }
           }
    },
    {
            $lookup: {                               // приєднання
                    from: "students",
                    localField: "class_curator",
                    foreignField: "class",
                    as: "zabriki"
             }
     },
     {
            $match: {                                // пошук "zabriki.name": "Bob"
                 "zabriki.name": "Bob"
            }
     }
]);
------------------------------------------------------------------------------------------------------------------------


                                               $unwind:{} - розкриває масив записів ()

/////////////////////////////////////////////////aggregate([{$unwind:"$......"}])///////////////////////////////////////

db.getCollection('teacher').aggregate([
    {
           $match: {                                                 // в кого class_curator: { $exists: true }
                class_curator: { $exists: true }
           }
    },
    {
            $lookup: {                                              // приєднання
                    from: "students",
                    localField: "class_curator",
                    foreignField: "class",
                    as: "zabriki"
             }
     },
     {
            $match: {
                 "zabriki.name": "Bob"                              // пошук "zabriki.name": "Bob"
            }
     },
     {
            $unwind: "$zabriki"                                    // розкриває масив і робить поокремо, присвоючи id
     }
])
------------------------------------------------------------------------------------------------------------------------

                                                приклад unwind
     {
            name: "Mariia",
            students: ["Antor", "Vika", "Vova", "Khry"]
     }
      ///////////////////

     {
         name: "Mariia",
         students: "Antor"
     },
     {
         name: "Mariia",
         students: "Vika"
     },
     {
         name: "Mariia",
         students: "Vova"
     },
     {
         name: "Mariia",
         students: "Khry"
     },
------------------------------------------------------------------------------------------------------------------------





